## 4.1 AdminUserService：管理员相关操作

### 4.1.1 login：登录操作

+ 测试用例设计方法：等价类划分

+ 具体用例及测试代码：

	1. 用户名密码均正确（编号：service-login-1）

		```java
		// 测试登录成功的情况
		    @Test
		    public void testLogin_Successful() {
		        AdminUser adminUser = new AdminUser();
		        adminUser.setUserName("valid_username");
		        adminUser.setPassword("valid_password");
		
		        // 设置 Mock 对象的预期行为
		        EasyMock.expect(adminUserMapperMock.login(adminUser)).andReturn(adminUser);
		
		        // 启动 Mock 对象
		        EasyMock.replay(adminUserMapperMock);
		
		        // 调用被测试方法
		        AdminUser loggedInUser = adminUserService.login(adminUser);
		
		        // 验证结果
		        Assertions.assertNotNull(loggedInUser);
		
		        // 验证 Mock 对象的方法是否按预期调用
		        EasyMock.verify(adminUserMapperMock);
		    }
		```

	2. 密码错误：（编号：service-login-2）

		```java
		// 测试密码错误的情况
		    @Test
		    public void testLogin_IncorrectPassword() {
		        AdminUser adminUser = new AdminUser();
		        adminUser.setUserName("invalid_username");
		        adminUser.setPassword("invalid_password");
		
		        // 设置 Mock 对象的预期行为
		        EasyMock.expect(adminUserMapperMock.login(adminUser)).andReturn(null);
		
		        // 启动 Mock 对象
		        EasyMock.replay(adminUserMapperMock);
		
		        // 调用被测试方法
		        AdminUser loggedInUser = adminUserService.login(adminUser);
		
		        // 验证结果
		        Assertions.assertNull(loggedInUser);
		
		        // 验证 Mock 对象的方法是否按预期调用
		        EasyMock.verify(adminUserMapperMock);
		    }
		```

	3. 用户名不存在：（编号：service-login-3）

		```java
		// 测试用户名不存在的情况
		    @Test
		    public void testLogin_UsernameNotFound() {
		        AdminUser adminUser = new AdminUser();
		        adminUser.setUserName("nonexistent_username");
		        adminUser.setPassword("any_password");
		
		        // 设置 Mock 对象的预期行为
		        EasyMock.expect(adminUserMapperMock.login(adminUser)).andReturn(null);
		
		        // 启动 Mock 对象
		        EasyMock.replay(adminUserMapperMock);
		
		        // 调用被测试方法
		        AdminUser loggedInUser = adminUserService.login(adminUser);
		
		        // 验证结果
		        Assertions.assertNull(loggedInUser);
		
		        // 验证 Mock 对象的方法是否按预期调用
		        EasyMock.verify(adminUserMapperMock);
		    }
		```

	4. 密码为空：（编号：service-login-4）

		```java
		// 测试密码为空的情况
		    @Test
		    public void testLogin_EmptyPassword() {
		        AdminUser adminUser = new AdminUser();
		        adminUser.setUserName("valid_username");
		        adminUser.setPassword("");
		
		        // 调用被测试方法
		        AdminUser loggedInUser = adminUserService.login(adminUser);
		
		        // 验证结果
		        Assertions.assertNull(loggedInUser);
		    }
		```

	   5. 用户名为空

		```java
		// 测试用户名为空的情况
		    @Test
		    public void testLogin_EmptyUsername() {
		        AdminUser adminUser = new AdminUser();
		        adminUser.setUserName("");
		        adminUser.setPassword("valid_password");
		
		        // 调用被测试方法
		        AdminUser loggedInUser = adminUserService.login(adminUser);
		
		        // 验证结果
		        Assertions.assertNull(loggedInUser);
		    }
		```

	

+ 测试结果如下：

![QQ截图20240517111218](QQ%E6%88%AA%E5%9B%BE20240517111218.png)

+ 测试全部通过，程序能完美解决各类不合法输入带来的问题。



## 4.2 LoginInterceptor：登录拦截器

+ 作用：拦截登录信息，判断是用户登录还是管理员登录

+ 测试用例设计方法：等价类划分

+ 具体用例及测试代码：

	1. 用户登录，且登录有效（编号：itcp-login-1）

		```java
		@Test
		    public void testPreHandle_Frontend_ValidUserSession() throws Exception {
		        // 测试前台用户访问地址，且有有效用户会话存在的情况
		        String requestURI = "/user_myorderlist";
		        EasyMock.expect(requestMock.getRequestURI()).andReturn(requestURI);
		        EasyMock.expect(requestMock.getSession()).andReturn(sessionMock);
		        EasyMock.expect(sessionMock.getAttribute("user")).andReturn(new User());
		        EasyMock.replay(requestMock, responseMock, sessionMock);
		
		        assertTrue(interceptor.preHandle(requestMock, responseMock, null));
		
		        EasyMock.verify(requestMock, responseMock, sessionMock);
		    }
		```

	2. 用户登录，但session无效：（编号：itcp-login-2）

		```java
		@Test
		    public void testPreHandle_Frontend_InvalidUserSession() throws Exception {
		        // 测试前台用户访问地址，但用户会话无效的情况
		        String requestURI = "/user_myorderlist";
		        EasyMock.expect(requestMock.getRequestURI()).andReturn(requestURI);
		        EasyMock.expect(requestMock.getSession()).andReturn(sessionMock);
		        EasyMock.expect(sessionMock.getAttribute("user")).andReturn(null);
		        EasyMock.expect(responseMock.getWriter()).andReturn(writerMock);
		        writerMock.print(EasyMock.eq("<script>location.href='/user_tologin';</script>"));
		        EasyMock.expectLastCall();
		        EasyMock.replay(requestMock, responseMock, sessionMock, writerMock);
		
		        assertFalse(interceptor.preHandle(requestMock, responseMock, null));
		
		        EasyMock.verify(requestMock, responseMock, sessionMock, writerMock);
		    }
		```

	3. 管理员登录，登录有效：（编号：itcp-login-3）

		```java
			@Test
		    public void testPreHandle_Admin_ValidAdminSession() throws Exception {
		        // 测试管理员访问地址，且有有效管理员会话存在的情况
		        String requestURI = "/admin/dashboard";
		        EasyMock.expect(requestMock.getRequestURI()).andReturn(requestURI);
		        EasyMock.expect(requestMock.getSession()).andReturn(sessionMock);
		        EasyMock.expect(sessionMock.getAttribute("admin")).andReturn(new AdminUser());
		        EasyMock.replay(requestMock, responseMock, sessionMock);
		
		        assertTrue(interceptor.preHandle(requestMock, responseMock, null));
		
		        EasyMock.verify(requestMock, responseMock, sessionMock);
		    }
		```

	4. 管理员登录，登录无效：（编号：service-login-4）

		```java
		@Test
		    public void testPreHandle_Admin_InvalidAdminSession() throws Exception {
		        // 测试管理员访问地址，但管理员会话无效的情况
		        String requestURI = "/admin/dashboard";
		        EasyMock.expect(requestMock.getRequestURI()).andReturn(requestURI);
		        EasyMock.expect(requestMock.getSession()).andReturn(sessionMock);
		        EasyMock.expect(sessionMock.getAttribute("admin")).andReturn(null);
		        EasyMock.expect(responseMock.getWriter()).andReturn(writerMock);
		        writerMock.print(EasyMock.eq("<script>location.href='/admin';</script>"));
		        EasyMock.expectLastCall();
		        EasyMock.replay(requestMock, responseMock, sessionMock, writerMock);
		
		        assertFalse(interceptor.preHandle(requestMock, responseMock, null));
		
		        EasyMock.verify(requestMock, responseMock, sessionMock, writerMock);
		    }
		```

+ 测试结果如下：

![QQ截图20240517111758](%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95.assets/QQ%E6%88%AA%E5%9B%BE20240517111758.png)

+ 测试全部通过，程序能完美解决各类不合法输入带来的问题，也能成功跳转到对应的前端界面。



## 4.3 AdminUserController：管理员相关操作

### 4.3.1 list：分页查询列表操作

+ 测试用例设计方法：边界值法

+ 具体用例及测试代码：

	1. pageNumber为最大值（编号：admin-list-1）

		```java
		@Test
		    public void testList_MaxPageNumber1() {
		        // 当pageNumber为最大值时
		        String userName = "abc";
		        long pageNumber = Long.MAX_VALUE;
		        long pageSize = 7;
		
		        // 创建模拟的 Page 对象
		        Page<AdminUser> pageMock = new Page<>();
		        pageMock.setPages(pageNumber);
		        pageMock.setSize(pageSize);
		        pageMock.setRecords(Collections.emptyList());
		
		        PagerHelper<AdminUser> helperMock = new PagerHelper<>(pageNumber, pageSize, pageMock.getPages(), pageMock.getTotal(), pageMock.getRecords());
		
		        // 设置对 adminUserService.page() 方法的期望行为
		        when(adminUserService.page(anyObject(), anyObject())).thenReturn(pageMock);
		
		        // 调用被测试的方法
		        String result = adminUserController.list(pageNumber, pageSize, userName, model);
		
		        // 验证结果和模拟对象行为
		        assertEquals("admin/adminList", result);
		        verify(model).addAttribute(eq("pagerHelper"), eq(helperMock));
		        verify(model).addAttribute(eq("userName"), eq(userName));
		    }
		```

	2. pageSize，pageNumber均为最小值1：（编号：admin-list-2）

		```java
		@Test
		    public void testList_MinPageNumber_MinPageSize() {
		        // 当pageNumber和pageSize都为最小值时
		        String userName = "";
		        long pageNumber = 1;
		        long pageSize = 1;
		
		        // 创建模拟的 Page 对象
		        Page<AdminUser> pageMock = new Page<>();
		        pageMock.setTotal(10L);
		        pageMock.setPages(2L);
		        pageMock.setSize(1L);
		        pageMock.setRecords(Collections.emptyList());
		
		        // 创建模拟的 PagerHelper 对象
		        PagerHelper<AdminUser> helperMock = new PagerHelper<>(pageNumber, pageSize, pageMock.getPages(), pageMock.getTotal(), pageMock.getRecords());
		
		        // 创建模拟的 AdminUserService 对象
		        AdminUserService adminUserService = mock(AdminUserService.class);
		        when(adminUserService.page(anyObject(), anyObject())).thenReturn(pageMock);
		
		        // 创建模拟的 Model 对象
		        Model model = mock(Model.class);
		
		        // 调用被测试的方法
		        AdminUserController adminUserController = new AdminUserController();
		        adminUserController.setAdminUserService(adminUserService);
		        String result = adminUserController.list(pageNumber, pageSize, userName, model);
		
		        // 验证结果和模拟对象行为
		        assertEquals("admin/adminList", result);
		        verify(model).addAttribute(eq("pagerHelper"), eq(helperMock)); // 第一个参数修改为 "pagerHelper"，第二个参数为任意类型的 PagerHelper
		        verify(model).addAttribute(eq("userName"), eq(userName)); // 验证添加的参数类型为 String
		    }
		```

	3. pageSize，pageNumber均为最大值：（编号：admin-list-3）

		```java
		  @Test
		    public void testList_MaxPageNumber_MaxPageSize() {
		        // 当pageNumber和pageSize都为最大值时
		        String userName = "";
		        long pageNumber = Long.MAX_VALUE;
		        long pageSize = Long.MAX_VALUE;
		
		        // 创建模拟的 Page 对象
		        Page<AdminUser> pageMock = new Page<>();
		        pageMock.setPages(pageNumber);
		        pageMock.setSize(pageSize);
		        pageMock.setRecords(Collections.emptyList());
		
		        // 创建模拟的 PagerHelper 对象
		        PagerHelper<AdminUser> helperMock = new PagerHelper<>(pageNumber, pageSize, pageMock.getPages(), pageMock.getTotal(), pageMock.getRecords());
		
		        // 创建模拟的 AdminUserService 对象
		        AdminUserService adminUserService = mock(AdminUserService.class);
		        when(adminUserService.page(anyObject(), anyObject())).thenReturn(pageMock);
		
		        // 创建模拟的 Model 对象
		        Model model = mock(Model.class);
		
		        // 调用被测试的方法
		        AdminUserController adminUserController = new AdminUserController();
		        adminUserController.setAdminUserService(adminUserService);
		        String result = adminUserController.list(pageNumber, pageSize, userName, model);
		
		        // 验证结果和模拟对象行为
		        assertEquals("admin/adminList", result);
		        verify(model).addAttribute(eq("pagerHelper"), eq(helperMock)); // 第一个参数修改为 "pagerHelper"，第二个参数为任意类型的 PagerHelper
		        verify(model).addAttribute(eq("userName"), eq(userName)); // 验证添加的参数类型为 String
		    }
		```

	4. pageSize为最小值：（编号：admin-list-4）

		```java
		@Test
		    public void testList_MinPageSize() {
		        // 当pageSize为最小值时
		        String userName = "";
		        long pageNumber = 1;
		        long pageSize = 1;
		
		        // 创建模拟的 Page 对象
		        Page<AdminUser> pageMock = new Page<>();
		        pageMock.setTotal(100L);
		        pageMock.setPages(pageNumber);
		        pageMock.setSize(pageSize);
		        pageMock.setRecords(Collections.emptyList());
		
		        // 创建模拟的 PagerHelper 对象
		        PagerHelper<AdminUser> helperMock = new PagerHelper<>(pageNumber, pageSize, pageMock.getPages(), pageMock.getTotal(), pageMock.getRecords());
		
		        // 创建模拟的 AdminUserService 对象
		        AdminUserService adminUserService = mock(AdminUserService.class);
		        when(adminUserService.page(anyObject(), anyObject())).thenReturn(pageMock);
		
		        // 创建模拟的 Model 对象
		        Model model = mock(Model.class);
		
		        // 调用被测试的方法
		        AdminUserController adminUserController = new AdminUserController();
		        adminUserController.setAdminUserService(adminUserService);
		        String result = adminUserController.list(pageNumber, pageSize, userName, model);
		
		        // 验证结果和模拟对象行为
		        assertEquals("admin/adminList", result);
		        verify(model).addAttribute(eq("pagerHelper"), eq(helperMock)); // 第一个参数修改为 "pagerHelper"，第二个参数为任意类型的 PagerHelper
		        verify(model).addAttribute(eq("userName"), eq(userName)); // 验证添加的参数类型为 String
		    }
		```

+ 测试结果如下：

![QQ截图20240516234842](%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95.assets/QQ%E6%88%AA%E5%9B%BE20240516234842.png)

+ 测试全部通过，程序目前没有什么问题。



### 4.3.2 login：登录操作

+ 测试用例设计方法：等价类划分

+ 具体用例及测试代码：

	1. 正确等价类：登录成功（编号：admin-login-1）

		```java
		// 测试登录成功的情况
		    @Test
		    public void testLogin_Success() {
		        AdminUser adminUser = new AdminUser();
		        adminUser.setUserName("admin");
		        adminUser.setPassword("password");
		
		        // 设置模拟对象的预期行为
		        expect(session.getAttribute("sysCode")).andReturn("code");
		        expect(adminUserService.getOne(anyObject())).andReturn(adminUser);
		        replay(session, adminUserService);
		
		        // 执行被测试的方法
		        String result = adminUserController.login(adminUser, "code", session, model);
		        // 预计跳转到index界面
		        assertEquals("index", result);
		    }
		```

	2. 密码错误情况：（编号：admin-login-2）

		```java
		// 测试密码错误的情况
		    @Test
		    public void testLogin_IncorrectPassword() {
		        AdminUser adminUser = new AdminUser();
		        adminUser.setUserName("admin");
		        adminUser.setPassword("incorrect");
		
		        expect(session.getAttribute("sysCode")).andReturn("code");
		        expect(adminUserService.getOne(anyObject())).andReturn(null);
		        replay(session, adminUserService);
		
		        String result = adminUserController.login(adminUser, "code", session, model);
		        // 预计返回登陆页面
		        assertEquals("login", result);
		    }
		```

	3. 用户名错误：（编号：admin-login-3）

		```java
		// 测试用户名错误的情况
		    @Test
		    public void testLogin_IncorrectUsername() {
		        AdminUser adminUser = new AdminUser();
		        adminUser.setUserName("incorrect");
		        adminUser.setPassword("password");
		
		        expect(session.getAttribute("sysCode")).andReturn("code");
		        expect(adminUserService.getOne(anyObject())).andReturn(null);
		        replay(session, adminUserService);
		
		        String result = adminUserController.login(adminUser, "code", session, model);
		        assertEquals("login", result);
		    }
		```

	4. 验证码错误：（编号：admin-login-4）

		```java
		// 测试验证码错误的情况
		    @Test
		    public void testLogin_IncorrectVerificationCode() {
		        AdminUser adminUser = new AdminUser();
		        adminUser.setUserName("admin");
		        adminUser.setPassword("password");
		
		        expect(session.getAttribute("sysCode")).andReturn("code");
		        replay(session);
		
		        String result = adminUserController.login(adminUser, "incorrectCode", session, model);
		        assertEquals("login", result);
		    }
		```

	5. session为空：（编号：admin-login-5）

		```java
		// 测试session为空的情况
		    @Test
		    public void testLogin_NullSession() {
		        AdminUser adminUser = new AdminUser();
		        adminUser.setUserName("admin");
		        adminUser.setPassword("password");
		
		        String result = adminUserController.login(adminUser, "code", null, model);
		        assertEquals("login", result);
		    }
		```

+ 测试结果如下：

![QQ截图20240516221707](%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95.assets/QQ%E6%88%AA%E5%9B%BE20240516221707.png)

+ 其中：
	1. 无论账号密码错误，程序都能正确执行，返回错误码。
	2. 当session为空时，程序报出错误，是因为程序默认session不会为空，故直接调用了session的API，当session为空时，程序报空指针错误。



### 4.3.3 add：添加管理员

+ 测试用例设计方法：等价类划分

+ 具体用例及测试代码：

	1. 正确等价类：添加成功（编号：admin-add-1）

		```java
		// 测试添加管理员成功的情况
		    @Test
		    public void testAdd_ValidAdminUser_ValidSession() {
		        // 准备测试数据
		        AdminUser adminUser = new AdminUser();
		        adminUser.setUserName("test");
		        adminUser.setPassword("password");
		        HttpSession session = new MockHttpSession();
		
		        // 创建模拟的 AdminUserService 对象
		        AdminUserService adminUserService = createMock(AdminUserService.class);
		        expect(adminUserService.save(adminUser)).andReturn(true);
		        replay(adminUserService);
		
		        // 调用被测试的方法
		        AdminUserController adminUserController = new AdminUserController();
		        adminUserController.setAdminUserService(adminUserService);
		        CommonResult result = adminUserController.add(adminUser, session);
		
		        // 验证结果
		        assertEquals(Integer.valueOf(200), result.getCode());
		        assertEquals("请求成功", result.getMessage());
		
		        // 验证模拟对象行为
		        verify(adminUserService);
		    }
		```

	2. adminUser为空的情况：（编号：admin-add-2）

		```java
		@Test
		    public void testAdd_NullAdminUser_ValidSession() {
		        // 准备测试数据
		        AdminUser adminUser = null;
		        HttpSession session = new MockHttpSession();
		
		        // 创建模拟的 AdminUserService 对象
		        AdminUserService adminUserService = createMock(AdminUserService.class);
		
		        // 调用被测试的方法
		        AdminUserController adminUserController = new AdminUserController();
		        adminUserController.setAdminUserService(adminUserService);
		        CommonResult result = adminUserController.add(adminUser, session);
		
		        // 验证结果
		        assertEquals(Integer.valueOf(400), result.getCode()); // 假设返回码为 400 表示请求失败
		        assertEquals("请求失败，参数不能为空", result.getMessage());
		
		        // 验证模拟对象行为
		        verify(adminUserService);
		    }
		```

	3. session为空：（编号：admin-add-3）

		```java
		@Test
		    public void testAdd_ValidAdminUser_NullSession() {
		        // 准备测试数据
		        AdminUser adminUser = new AdminUser();
		        adminUser.setUserName("test");
		        adminUser.setPassword("password");
		        HttpSession session = null;
		
		        // 创建模拟的 AdminUserService 对象
		        AdminUserService adminUserService = createMock(AdminUserService.class);
		
		        // 调用被测试的方法
		        AdminUserController adminUserController = new AdminUserController();
		        adminUserController.setAdminUserService(adminUserService);
		        CommonResult result = adminUserController.add(adminUser, session);
		
		        // 验证结果
		        assertEquals(Integer.valueOf(400), result.getCode()); // 假设返回码为 400 表示请求失败
		        assertEquals("请求失败，session不能为空", result.getMessage());
		
		        // 验证模拟对象行为
		        verify(adminUserService);
		    }
		```

+ 测试结果如下：

![QQ截图20240516231837](%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95.assets/QQ%E6%88%AA%E5%9B%BE20240516231837.png)

+ 其中：
	1. 当AdminUser对象null时，程序报空指针错误，原因为程序直接调用AdminUser对象的方法，没有判断是否为空。
	2. 当session为空时，本该返回错误码500，但程序仍然返回正确码200，原因为程序没有对session进行判断和限制。



### 4.3.4 update：修改管理员

+ 测试用例设计方法：等价类划分

+ 具体用例及测试代码：

	1. 正确等价类：合法的AdminUser和session（编号：admin-update-1）

		```java
		@Test
		    public void testUpdate_ValidAdminUser_ValidSession() {
		        // 测试更新操作，当传入合法的用户对象和有效的会话时
		        AdminUser adminUser = new AdminUser();
		        adminUser.setUserName("test");
		        adminUser.setPassword("password");
		        HttpSession session = new MockHttpSession();
		
		        // 创建模拟的 AdminUserService 对象
		        AdminUserService adminUserService = createMock(AdminUserService.class);
		        expect(adminUserService.updateById(adminUser)).andReturn(true);
		        replay(adminUserService);
		
		        // 调用被测试的方法
		        AdminUserController adminUserController = new AdminUserController();
		        adminUserController.setAdminUserService(adminUserService);
		        CommonResult result = adminUserController.update(adminUser, session);
		
		        // 验证结果
		        assertEquals(Integer.valueOf(200), result.getCode());
		        assertEquals("请求成功", result.getMessage());
		        assertNotNull(result.getData());
		
		        // 验证模拟对象行为
		        verify(adminUserService);
		    }
		```

	2. adminUser为空的情况：（编号：admin-update-2）

		```java
		@Test
		    public void testUpdate_NullAdminUser_ValidSession() {
		        // 测试更新操作，当传入空的用户对象和有效的会话时
		        AdminUser adminUser = null;
		        HttpSession session = new MockHttpSession();
		
		        // 创建模拟的 AdminUserService 对象
		        AdminUserService adminUserService = createMock(AdminUserService.class);
		
		        // 调用被测试的方法
		        AdminUserController adminUserController = new AdminUserController();
		        adminUserController.setAdminUserService(adminUserService);
		        CommonResult result = adminUserController.update(adminUser, session);
		
		        // 验证结果
		        assertEquals(Integer.valueOf(400), result.getCode()); // 假设返回码为 400 表示请求失败
		        assertEquals("请求失败，参数不能为空", result.getMessage());
		
		        // 验证模拟对象行为
		        verify(adminUserService);
		    }
		```

	3. session为空：（编号：admin-update-3）

		```java
		@Test
		    public void testUpdate_ValidAdminUser_NullSession() {
		        // 测试更新操作，当传入合法的用户对象和空的会话时
		        AdminUser adminUser = new AdminUser();
		        adminUser.setUserName("test");
		        adminUser.setPassword("password");
		        HttpSession session = null;
		
		        // 创建模拟的 AdminUserService 对象
		        AdminUserService adminUserService = createMock(AdminUserService.class);
		
		        // 调用被测试的方法
		        AdminUserController adminUserController = new AdminUserController();
		        adminUserController.setAdminUserService(adminUserService);
		        CommonResult result = adminUserController.update(adminUser, session);
		
		        // 验证结果
		        assertEquals(Integer.valueOf(400), result.getCode()); // 假设返回码为 400 表示请求失败
		        assertEquals("请求失败，session不能为空", result.getMessage());
		
		        // 验证模拟对象行为
		        verify(adminUserService);
		    }
		```

+ 测试结果如下：

![QQ截图20240516232354](%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95.assets/QQ%E6%88%AA%E5%9B%BE20240516232354.png)

+ 其中：
	1. 当AdminUser对象null时，程序报空指针错误，原因为程序直接调用AdminUser对象的方法，没有判断是否为空。
	2. 当session为空时，本该返回错误码500，但程序仍然返回正确码200，原因为程序没有对session进行判断和限制。



### 4.3.5 delete：删除管理员

+ 测试用例设计方法：等价类划分

+ 具体用例及测试代码：

	1. 正确等价类：有效的用户id（编号：admin-delete-1）

		```java
		@Test
		    public void testDelete_ValidId() {
		        // 测试删除操作，当传入有效的用户ID时
		        String id = "123";
		
		        // 创建模拟的 AdminUserService 对象
		        AdminUserService adminUserService = createMock(AdminUserService.class);
		        AdminUser adminUser = new AdminUser();
		        adminUser.setId(id);
		        expect(adminUserService.getById(id)).andReturn(adminUser); // 假设存在该用户
		        adminUser.setDeleteStatus(1); // 删除状态
		        expect(adminUserService.updateById(adminUser)).andStubReturn(true); // 指定 updateById 方法的返回值
		        replay(adminUserService);
		
		        // 调用被测试的方法
		        AdminUserController adminUserController = new AdminUserController();
		        adminUserController.setAdminUserService(adminUserService);
		        CommonResult result = adminUserController.delete(id);
		
		        // 验证结果
		        assertEquals(Integer.valueOf(200), result.getCode());
		        assertEquals("请求成功", result.getMessage());
		
		        // 验证模拟对象行为
		        verify(adminUserService);
		    }
		```

	2. 无效的用户id：（编号：admin-delete-2）

		```java
		@Test
		    public void testDelete_InvalidId() {
		        // 测试删除操作，当传入无效的用户ID时
		        String id = "456";
		
		        // 创建模拟的 AdminUserService 对象
		        AdminUserService adminUserService = createMock(AdminUserService.class);
		        expect(adminUserService.getById(id)).andReturn(null); // 假设不存在该用户
		        replay(adminUserService);
		
		        // 调用被测试的方法
		        AdminUserController adminUserController = new AdminUserController();
		        adminUserController.setAdminUserService(adminUserService);
		        CommonResult result = adminUserController.delete(id);
		
		        // 验证结果
		        assertEquals(Integer.valueOf(400), result.getCode()); // 假设返回码为 400 表示请求失败
		        assertEquals("请求失败，用户不存在", result.getMessage());
		
		        // 验证模拟对象行为
		        verify(adminUserService);
		    }
		```

+ 测试结果如下：

![QQ截图20240516234019](%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95.assets/QQ%E6%88%AA%E5%9B%BE20240516234019.png)

+ 其中：
	1. 程序没有考虑传入用户不存在的情况，故报空指针错误。



## 4.4 CarController：车相关操作

### 4.4.1 add：添加操作

+ 测试用例设计方法：等价类划分

+ 具体用例及测试代码：

	1. 正确等价类：有效的Car对象（编号：car-add-1）

		```java
		@Test
		    public void testAddWithValidCarAndSession() {
		        // 准备有效的 Car 对象
		        Car validCar = new Car(/* 设置有效的车辆信息 */);
		
		        // 设置 Mock 对象的行为
		        EasyMock.expect(sessionMock.getAttribute("userId")).andReturn("b496894b89754a848e9b74ff66a05d44");
		        EasyMock.expect(carServiceMock.save(EasyMock.anyObject(Car.class))).andStubReturn(true);
		        EasyMock.replay(sessionMock, carServiceMock);
		
		        // 调用被测试的方法
		        CommonResult responseEntity = carController.add(validCar, sessionMock);
		
		        // 验证结果
		        Assertions.assertEquals(Integer.valueOf(200), responseEntity.getCode());
		        Assertions.assertEquals("请求成功", responseEntity.getMessage());
		    }
		```

	2. 无效的Car对象：（编号：car-add-2）

		```java
		@Test
		    public void testAddWithInvalidCarAndValidSession() {
		        // 准备无效的 Car 对象
		        Car invalidCar = new Car(/* 设置无效的车辆信息 */);
		
		        // 设置 Mock 对象的行为
		        EasyMock.expect(sessionMock.getAttribute("userId")).andReturn("b496894b89754a848e9b74ff66a05d44");
		        EasyMock.expect(carServiceMock.save(EasyMock.anyObject(Car.class))).andStubReturn(false); // 修改为保存失败
		        EasyMock.replay(sessionMock, carServiceMock);
		
		        // 调用被测试的方法
		        CommonResult responseEntity = carController.add(invalidCar, sessionMock);
		
		        // 验证结果
		        Assertions.assertNotEquals(Integer.valueOf(200), responseEntity.getCode()); // 修改为保存失败的状态码
		        Assertions.assertEquals("请求失败", responseEntity.getMessage()); // 修改为保存失败的消息
		    }
		```

	3. session为null：（编号：car-add-3）

		```java
		@Test
		    public void testAddWithValidCarAndNullSession() {
		        // 准备有效的 Car 对象
		        Car validCar = new Car(/* 设置有效的车辆信息 */);
		
		        // 设置 Mock 对象的行为
		        // 这里不设置对 session 的行为，即 session 为 null
		
		        // 调用被测试的方法
		        CommonResult responseEntity = carController.add(validCar, null);
		
		        // 验证结果
		        Assertions.assertNotEquals(Integer.valueOf(200), responseEntity.getCode()); // 修改为服务器错误的状态码
		        Assertions.assertEquals("请求失败", responseEntity.getMessage()); // 修改为服务器错误的消息
		    }
		```

+ 测试结果如下：

![QQ截图20240516235354](%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95.assets/QQ%E6%88%AA%E5%9B%BE20240516235354.png)

+ 其中：
	1. 程序默认Car对象为有效对象，当car和session为无效对象时，本该返回错误码500，但仍然返回200，没有做出异常判断及措施。



### 4.4.2 delete：车删除操作

+ 测试用例设计方法：等价类划分

+ 具体用例及测试代码：

	1. 正确等价类：有效的id（编号：car-delete-1）

		```java
		@Test
		    public void testDeleteWithValidInput() {
		        // 准备有效的输入
		        String id = "valid_id";
		
		        // 设置 Mock 对象的行为
		        Car car = new Car(/* 设置合法的车辆信息 */);
		        EasyMock.expect(carServiceMock.getById(id)).andReturn(car);
		        EasyMock.expect(carServiceMock.updateById(car)).andStubReturn(true);
		        EasyMock.replay(carServiceMock);
		
		        // 调用被测试的方法
		        CommonResult result = carController.delete(id);
		
		        // 验证结果
		        Assertions.assertEquals(Integer.valueOf(200), result.getCode());
		        Assertions.assertEquals("请求成功", result.getMessage());
		    }
		```

	2. 无效的id：（编号：car-delete-2）

		```java
		@Test
		    public void testDeleteWithInvalidInput() {
		        // 准备无效的输入
		        String id = "invalid_id";
		
		        // 设置 Mock 对象的行为
		        EasyMock.expect(carServiceMock.getById(id)).andReturn(null); // 车辆不存在于数据库中
		        EasyMock.replay(carServiceMock);
		
		        // 调用被测试的方法
		        CommonResult result = carController.delete(id);
		
		        // 验证结果
		        Assertions.assertEquals(Integer.valueOf(400), result.getCode());
		        Assertions.assertEquals("请求失败", result.getMessage());
		    }
		```

	3. 数据库访问异常：（编号：car-delete-3）

		```java
		@Test
		    public void testDeleteWithException() {
		        // 准备有效的输入
		        String id = "valid_id";
		
		        // 设置 Mock 对象的行为
		        EasyMock.expect(carServiceMock.getById(id)).andThrow(new RuntimeException("数据库访问异常")); // 模拟异常发生
		        EasyMock.replay(carServiceMock);
		
		        // 调用被测试的方法
		        CommonResult result = carController.delete(id);
		
		        // 验证结果
		        Assertions.assertEquals(Integer.valueOf(500), result.getCode());
		        Assertions.assertEquals("请求失败", result.getMessage());
		    }
		```

+ 测试结果如下：

![QQ截图20240516235906](%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95.assets/QQ%E6%88%AA%E5%9B%BE20240516235906.png)

+ 其中：
	1. 程序默认id能够找到对应的车，当id为无效对象时，本该返回错误码500，但仍然返回200，没有做出异常判断及措施。



### 4.4.3 update：修改车

+ 测试用例设计方法：等价类划分

+ 具体用例及测试代码：

	1. 正确等价类：合法的Car和session（编号：car-update-1）

		```java
		@Test
		    public void testUpdateWithValidInputAndChangedImgUrl() {
		        // 准备合法的输入，并且图片 URL 发生变化
		        Car car = new Car(/* 设置合法的车辆信息 */);
		        Car oldCar = new Car(/* 设置数据库中原对象的信息 */);
		        oldCar.setImgUrl("old_img_url.jpg");
		
		        // 设置 Mock 对象的行为
		        EasyMock.expect(carServiceMock.getById(car.getId())).andReturn(oldCar);
		        EasyMock.expect(sessionMock.getAttribute("userId")).andReturn("b496894b89754a848e9b74ff66a05d44");
		        EasyMock.expect(carServiceMock.updateById(EasyMock.anyObject(Car.class))).andReturn(true); // 模拟更新成功
		        // 模拟删除老图片
		        EasyMock.replay(carServiceMock, sessionMock);
		
		        // 调用被测试的方法
		        CommonResult result = carController.update(car, sessionMock);
		
		        // 验证结果
		        Assertions.assertEquals(Integer.valueOf(200), result.getCode());
		        Assertions.assertEquals("请求成功", result.getMessage());
		    }
		```

	2. Car为null的情况：（编号：car-update-2）

		```java
		@Test
		    public void testUpdateWithNullCar() {
		        // 准备车辆对象为 null
		        Car car = null;
		
		        // 不需要设置 Mock 对象的行为，因为不会调用相关的服务方法
		
		        // 调用被测试的方法
		        CommonResult result = carController.update(car, sessionMock);
		
		        // 验证结果
		        Assertions.assertNotEquals(Integer.valueOf(200), result.getCode());
		        Assertions.assertEquals("请求失败", result.getMessage());
		    }
		```

	3. Car为空对象：（编号：car-update-3）

		```java
		@Test
		    public void testUpdateWithInvalidCarAndValidSession() {
		        // 准备无效的车辆对象
		        Car car = new Car(/* 设置无效的车辆信息 */);
		
		        // 设置 Mock 对象的行为
		        EasyMock.expect(carServiceMock.getById(car.getId())).andReturn(null); // 车辆不存在于数据库中
		        EasyMock.replay(carServiceMock, sessionMock);
		
		        // 调用被测试的方法
		        CommonResult result = carController.update(car, sessionMock);
		
		        // 验证结果
		        Assertions.assertEquals(Integer.valueOf(400), result.getCode());
		        Assertions.assertEquals("请求失败，车辆不存在", result.getMessage());
		    }
		```

	4. session为null：（编号：car-update-4）

		```java
			@Test
		    public void testUpdateWithNullSession() {
		        // 准备合法的车辆对象，但会话对象为 null
		        Car car = new Car(/* 设置合法的车辆信息 */);
		
		        // 不需要设置 Mock 对象的行为，因为不会调用相关的服务方法
		
		        // 调用被测试的方法
		        CommonResult result = carController.update(car, null);
		
		        // 验证结果
		        Assertions.assertEquals(Integer.valueOf(400), result.getCode());
		        Assertions.assertEquals("请求参数错误", result.getMessage());
		    }	
		```

	5. 访问数据库异常：（编号：car-update-5）

		```java
		// 模拟异常
		    @Test
		    public void testUpdateWithException() {
		        // 准备有效的车辆对象
		        Car car = new Car(/* 设置合法的车辆信息 */);
		
		        // 设置 Mock 对象的行为
		        EasyMock.expect(carServiceMock.getById(car.getId())).andThrow(new RuntimeException("数据库访问异常")); // 模拟异常发生
		        EasyMock.replay(carServiceMock, sessionMock);
		
		        // 调用被测试的方法
		        CommonResult result = carController.update(car, sessionMock);
		
		        // 验证结果
		        Assertions.assertEquals(Integer.valueOf(500), result.getCode());
		        Assertions.assertEquals("请求失败", result.getMessage());
		    }
		```

+ 测试结果如下：

![QQ截图20240517000614](%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95.assets/QQ%E6%88%AA%E5%9B%BE20240517000614.png)

+ 其中：
	1. 程序能正确应对car为null以及访问数据库异常的情况。
	2. 程序无法应对session为null以及car为空对象的情况。
	3. 以及当car的url属性改变时，本该修改失败，返回错误码，但程序仍然返回正确码。



### 4.4.4 list：车的分页查询

+ 测试用例设计方法：边界值法

+ 具体用例及测试代码：

	1. 使用默认值（编号：car-list-1）

		```java
		@Test
		    public void testList_DefaultValues() {
		        // 当参数使用默认值时
		        String title = "";
		        long pageNumber = 1;
		        long pageSize = 7;
		
		        // 创建模拟的 Page 对象
		        Page<Car> pageMock = new Page<>();
		        pageMock.setTotal(100L);
		        pageMock.setPages(pageNumber);
		        pageMock.setSize(pageSize);
		        pageMock.setRecords(Collections.emptyList());
		
		        // 创建模拟的 PagerHelper 对象
		        PagerHelper<Car> helperMock = new PagerHelper<>(pageNumber, pageSize, pageMock.getPages(), pageMock.getTotal(), pageMock.getRecords());
		
		        // 设置对 carService.page() 方法的期望行为
		        QueryWrapper<Car> queryWrapper = new QueryWrapper<>();
		        queryWrapper.eq("DELETE_STATUS", 0);
		        queryWrapper.orderByDesc("ADD_TIME");
		        when(carServiceMock.page(any(), any())).thenReturn(pageMock);
		
		
		        // 调用被测试的方法
		        String result = carController.list(pageNumber, pageSize, title, modelMock);
		
		        // 验证结果和模拟对象行为
		        assertEquals("car/carList", result);
		        verify(carServiceMock).page(any(Page.class), any(QueryWrapper.class));
		        verify(modelMock).addAttribute("pagerHelper", helperMock);
		        verify(modelMock).addAttribute("title", title);
		    }
		```

	2. 正常值：（编号：car-list-2）

		```java
		@Test
		    public void testList_NormalPage_NormalSize_NotEmptyTitle() {
		        // 当pageNumber为正常值，pageSize为正常值，且title不为空时
		        String title = "non-empty title";
		        long pageNumber = 2;
		        long pageSize = 10;
		
		        // 创建模拟的 Page 对象
		        Page<Car> pageMock = new Page<>();
		        pageMock.setTotal(100L);
		        pageMock.setPages(pageNumber);
		        pageMock.setSize(pageSize);
		        pageMock.setRecords(Collections.emptyList());
		
		        // 创建模拟的 PagerHelper 对象
		        PagerHelper<Car> helperMock = new PagerHelper<>(pageNumber, pageSize, pageMock.getPages(), pageMock.getTotal(), pageMock.getRecords());
		
		        // 设置对 carService.page() 方法的期望行为
		        QueryWrapper<Car> queryWrapper = new QueryWrapper<>();
		        queryWrapper.eq("DELETE_STATUS", 0);
		        queryWrapper.orderByDesc("ADD_TIME");
		        when(carServiceMock.page(any(Page.class), any(QueryWrapper.class))).thenReturn(pageMock);
		
		        when(modelMock.addAttribute("pagerHelper", helperMock)).thenReturn(modelMock);
		        when(modelMock.addAttribute("title", title)).thenReturn(modelMock);
		
		        // 调用被测试的方法
		        String result = carController.list(pageNumber, pageSize, title, modelMock);
		
		        // 验证结果和模拟对象行为
		        assertEquals("car/carList", result);
		        verify(carServiceMock).page(any(Page.class), any(QueryWrapper.class));
		        verify(modelMock).addAttribute("pagerHelper", helperMock);
		        verify(modelMock).addAttribute("title", title);
		    }
		```

	3. pageNumber为最大：（编号：car-list-3）

		```java
		@Test
		    public void testList_MaxPageNumber1() {
		        // 当pageNumber为最大值时
		        String title = "abc";
		        long pageNumber = Long.MAX_VALUE;
		        long pageSize = 7;
		
		        // 创建模拟的 Page 对象
		        Page<Car> pageMock = new Page<>();
		        pageMock.setPages(pageNumber);
		        pageMock.setSize(pageSize);
		        pageMock.setRecords(Collections.emptyList());
		
		        PagerHelper<Car> helperMock = new PagerHelper<>(pageNumber, pageSize, pageMock.getPages(), pageMock.getTotal(), pageMock.getRecords());
		
		        // 设置对 carService.page() 方法的期望行为
		        QueryWrapper<Car> queryWrapper = new QueryWrapper<>();
		        queryWrapper.eq("DELETE_STATUS", 0);
		        queryWrapper.orderByDesc("ADD_TIME");
		        // 设置对 adminUserService.page() 方法的期望行为
		        when(carServiceMock.page(any(), any())).thenReturn(pageMock);
		
		        // 调用被测试的方法
		        String result = carController.list(pageNumber, pageSize, title, modelMock);
		
		        // 验证结果和模拟对象行为
		        assertEquals("car/carList", result);
		        verify(modelMock).addAttribute("pagerHelper", helperMock);
		        verify(modelMock).addAttribute("title", title);
		    }
		```

	   4. pageSize最大（编号：car-list-4）

		```java
		@Test
		    public void testList_NormalPage_MaxPageSize_NotEmptyTitle() {
		        // 当pageNumber为正常值，pageSize为最大值，且title不为空时
		        String title = "non-empty title";
		        long pageNumber = 2;
		        long pageSize = Long.MAX_VALUE;
		
		        // 创建模拟的 Page 对象
		        Page<Car> pageMock = new Page<>();
		        pageMock.setTotal(100L);
		        pageMock.setPages(pageNumber);
		        pageMock.setSize(pageSize);
		        pageMock.setRecords(Collections.emptyList());
		
		        // 创建模拟的 PagerHelper 对象
		        PagerHelper<Car> helperMock = new PagerHelper<>(pageNumber, pageSize, pageMock.getPages(), pageMock.getTotal(), pageMock.getRecords());
		
		        // 设置对 carService.page() 方法的期望行为
		        QueryWrapper<Car> queryWrapper = new QueryWrapper<>();
		        queryWrapper.eq("DELETE_STATUS", 0);
		        queryWrapper.orderByDesc("ADD_TIME");
		        when(carServiceMock.page(any(Page.class), any(QueryWrapper.class))).thenReturn(pageMock);
		
		        when(modelMock.addAttribute("pagerHelper", helperMock)).thenReturn(modelMock);
		        when(modelMock.addAttribute("title", title)).thenReturn(modelMock);
		
		        // 调用被测试的方法
		        String result = carController.list(pageNumber, pageSize, title, modelMock);
		
		        // 验证结果和模拟对象行为
		        assertEquals("car/carList", result);
		        verify(carServiceMock).page(any(Page.class), any(QueryWrapper.class));
		        verify(modelMock).addAttribute("pagerHelper", helperMock);
		        verify(modelMock).addAttribute("title", title);
		    }
		```

	5. pageNumber最大（编号：car-list-5）

		```java
		@Test
		    public void testList_MaxPageNumber_NormalPageSize_NotEmptyTitle() {
		        // 当pageNumber为最大值，pageSize为正常值，且title不为空时
		        String title = "non-empty title";
		        long pageNumber = Long.MAX_VALUE;
		        long pageSize = 10;
		
		        // 创建模拟的 Page 对象
		        Page<Car> pageMock = new Page<>();
		        pageMock.setPages(pageNumber);
		        pageMock.setSize(pageSize);
		        pageMock.setRecords(Collections.emptyList());
		
		        // 创建模拟的 PagerHelper 对象
		        PagerHelper<Car> helperMock = new PagerHelper<>(pageNumber, pageSize, pageMock.getPages(), pageMock.getTotal(), pageMock.getRecords());
		
		        // 设置对 carService.page() 方法的期望行为
		        QueryWrapper<Car> queryWrapper = new QueryWrapper<>();
		        queryWrapper.eq("DELETE_STATUS", 0);
		        queryWrapper.orderByDesc("ADD_TIME");
		        when(carServiceMock.page(any(Page.class), any(QueryWrapper.class))).thenReturn(pageMock);
		
		        when(modelMock.addAttribute("pagerHelper", helperMock)).thenReturn(modelMock);
		        when(modelMock.addAttribute("title", title)).thenReturn(modelMock);
		
		        // 调用被测试的方法
		        String result = carController.list(pageNumber, pageSize, title, modelMock);
		
		        // 验证结果和模拟对象行为
		        assertEquals("car/carList", result);
		        verify(carServiceMock).page(any(Page.class), any(QueryWrapper.class));
		        verify(modelMock).addAttribute("pagerHelper", helperMock);
		        verify(modelMock).addAttribute("title", title);
		    }
		```

+ 测试结果如下：

![QQ截图20240517001830](%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95.assets/QQ%E6%88%AA%E5%9B%BE20240517001830.png)

+ 程序能完美应对各种情况，测试通过。



## 4.5 HotelController：酒店相关操作

### 4.5.1 list：酒店的分页查询

+ 测试用例设计方法：边界值法

+ 具体用例及测试代码：

	1. 使用默认值（编号：hotel-list-1）

		```java
		@Test
		    public void testList_WithDefaultValues() {
		        // 准备默认值的输入
		        Long pageNumber = 1L;
		        Long pageSize = 7L;
		        String hotelName = "";
		
		        // 设置 Mock 对象的行为
		        Page<Hotel> pageMock = new Page<>();
		        pageMock.setPages(1L);
		        pageMock.setSize(7L);
		        pageMock.setRecords(Collections.emptyList());
		        PagerHelper<Hotel> pagerHelperMock = new PagerHelper<>(pageNumber, pageSize, pageMock.getPages(), pageMock.getTotal(), pageMock.getRecords());
		        when(hotelService.page(any(), any())).thenReturn(pageMock);
		
		        // 调用被测试的方法
		        String result = hotelController.list(pageNumber, pageSize, hotelName, model);
		
		        // 验证结果和模拟对象行为
		        assertEquals("hotel/hotelList", result);
		        verify(model).addAttribute(eq("pagerHelper"), eq(pagerHelperMock));
		        verify(model).addAttribute(eq("hotelName"), eq(hotelName));
		    }
		```

	2. 正常值：（编号：hotel-list-2）

		```java
		 @Test
		    public void testList_WithValidInput() {
		        // 准备有效的输入
		        Long pageNumber = 1L;
		        Long pageSize = 10L;
		        String hotelName = "testHotel";
		
		        // 设置 Mock 对象的行为
		        Page<Hotel> pageMock = new Page<>();
		        pageMock.setPages(1L);
		        pageMock.setSize(10L);
		        pageMock.setRecords(Collections.emptyList());
		        PagerHelper<Hotel> pagerHelperMock = new PagerHelper<>(pageNumber, pageSize, pageMock.getPages(), pageMock.getTotal(), pageMock.getRecords());
		        when(hotelService.page(any(), any())).thenReturn(pageMock);
		
		        // 调用被测试的方法
		        String result = hotelController.list(pageNumber, pageSize, hotelName, model);
		
		        // 验证结果和模拟对象行为
		        assertEquals("hotel/hotelList", result);
		        verify(model).addAttribute(eq("pagerHelper"), eq(pagerHelperMock));
		        verify(model).addAttribute(eq("hotelName"), eq(hotelName));
		    }
		```

	3. pageSize值为负数：（编号：hotel-list-3）

		```java
		@Test
		    public void testList_WithInvalidPageSize() {
		        // 准备无效的 pageSize 值
		        Long pageNumber = 1L;
		        Long pageSize = -1L;
		        String hotelName = "";
		
		        // 不需要设置 Mock 对象的行为，因为不会调用相关的服务方法
		
		        // 调用被测试的方法
		        String result = hotelController.list(pageNumber, pageSize, hotelName, model);
		
		        // 验证结果
		        assertEquals("hotel/hotelList", result); // 或者验证其他期望的结果
		        // 验证模拟对象的行为（如果有）
		    }
		```

		4. pageNumber为0（编号：hotel-list-4）

		```java
		@Test
		    public void testList_WithInvalidPageNumber() {
		        // 准备无效的 pageNumber 值
		        Long pageNumber = 0L;
		        Long pageSize = 10L;
		        String hotelName = "";
		
		        // 不需要设置 Mock 对象的行为，因为不会调用相关的服务方法
		
		        // 调用被测试的方法
		        String result = hotelController.list(pageNumber, pageSize, hotelName, model);
		
		        // 验证结果
		        assertEquals("hotel/hotelList", result); // 或者验证其他期望的结果
		        // 验证模拟对象的行为（如果有）
		    }
		```

	4. pageNumber，pageSize最大（编号：hotel-list-5）

		```java
		@Test
		    public void testList_WithMaxPageNumber() {
		        // 准备最大值的 pageNumber 和 pageSize
		        Long pageNumber = Long.MAX_VALUE;
		        Long pageSize = Long.MAX_VALUE;
		        String hotelName = "";
		
		        // 创建模拟的 Page 对象
		        Page<Hotel> pageMock = new Page<>();
		        pageMock.setPages(pageNumber);
		        pageMock.setSize(pageSize);
		        pageMock.setRecords(Collections.emptyList());
		
		        PagerHelper<Hotel> pagerHelperMock = new PagerHelper<>(pageNumber, pageSize, pageMock.getPages(), pageMock.getTotal(), pageMock.getRecords());
		
		        // 设置对 hotelService.page() 方法的期望行为
		        when(hotelService.page(anyObject(), anyObject())).thenReturn(pageMock);
		
		        // 调用被测试的方法
		        String result = hotelController.list(pageNumber, pageSize, hotelName, model);
		
		        // 验证结果和模拟对象行为
		        assertEquals("hotel/hotelList", result);
		        verify(model).addAttribute(eq("pagerHelper"), eq(pagerHelperMock));
		        verify(model).addAttribute(eq("hotelName"), eq(hotelName));
		    }
		```

+ 测试结果如下：

![QQ截图20240517112244](%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95.assets/QQ%E6%88%AA%E5%9B%BE20240517112244.png)

+ 其中：
	+ 当输入合法时，程序能正确执行。
	+ 但输入不合法时，程序均报空指针错误，无法执行。



### 4.5.2 ：酒店删除操作

+ 测试用例设计方法：等价类划分

+ 具体用例及测试代码：

	1. 正确等价类：有效的id（编号：hotel-delete-1）

		```java
		@Test
		    public void testDelete_ValidHotelId() {
		        // 准备有效的酒店ID
		        String hotelId = "1";
		
		        // 设置 Mock 对象的行为
		        when(hotelService.getById(hotelId)).thenReturn(new Hotel());
		
		        // 调用被测试的方法
		        CommonResult result = hotelController.delete(hotelId);
		
		        // 验证结果
		        assertNotNull(result);
		        assertEquals(Integer.valueOf(200), result.getCode());
		        assertEquals("请求成功", result.getMessage());
		
		        // 验证酒店的删除状态被设置为1
		        verify(hotelService).updateById(any(Hotel.class));
		    }
		```

	2. 无效的id：（编号：hotel-delete-2）

		```java
		@Test
		    public void testDelete_InvalidHotelId() {
		        // 准备无效的酒店ID
		        String hotelId = "invalid_id";
		
		        // 设置 Mock 对象的行为
		        when(hotelService.getById(hotelId)).thenReturn(null);
		
		        // 调用被测试的方法
		        CommonResult result = hotelController.delete(hotelId);
		
		        // 验证结果
		        assertNotNull(result);
		        assertEquals(Integer.valueOf(500), result.getCode());
		        assertEquals("请求失败", result.getMessage());
		
		        // 验证酒店的更新方法未被调用
		        verify(hotelService, never()).updateById(any(Hotel.class));
		    }
		```

+ 测试结果如下：

![QQ截图20240517120504](%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95.assets/QQ%E6%88%AA%E5%9B%BE20240517120504.png)

+ 其中：
	1. 程序默认id能够找到对应的酒店，当id为无效对象时，本该返回错误码500，但仍然返回200，没有做出异常判断及措施。



### 4.5.3 update：修改酒店

+ 测试用例设计方法：等价类划分

+ 具体用例及测试代码：

	1. 正确等价类：合法的Hotel和session（编号：hotel-update-1）

		```java
		@Test
		    public void testUpdate_ValidHotel_ValidSession() {
		        // 准备有效的输入
		        Hotel hotel = new Hotel();
		        hotel.setId("1");
		        hotel.setImgUrl("new_img_url.jpg");
		        Hotel oldHotel = new Hotel();
		        oldHotel.setId("1");
		        oldHotel.setImgUrl("old_img_url.jpg");
		        MockHttpSession session = new MockHttpSession();
		
		        // 设置 Mock 对象的行为
		        when(hotelService.getById(hotel.getId())).thenReturn(oldHotel);
		        when(hotelService.updateById(hotel)).thenReturn(true);
		
		        // 调用被测试的方法
		        CommonResult result = hotelController.update(hotel, session);
		
		        // 验证结果
		        assertNotNull(result);
		        assertEquals(Integer.valueOf(200), result.getCode());
		        assertEquals("请求成功", result.getMessage());
		    }
		```

	2. session为null：（编号：hotel-update-2）

		```java
		@Test
		    public void testUpdate_ValidHotel_InvalidSession() {
		        // 准备有效的输入，但会话对象为 null
		        Hotel hotel = new Hotel();
		        hotel.setId("1");
		        hotel.setImgUrl("new_img_url.jpg");
		
		        // 设置 Mock 对象的行为
		        when(hotelService.getById(hotel.getId())).thenReturn(new Hotel());
		        when(hotelService.updateById(hotel)).thenReturn(true);
		
		        // 调用被测试的方法
		        CommonResult result = hotelController.update(hotel, null);
		
		        // 验证结果
		        assertNotNull(result);
		        assertEquals(Integer.valueOf(400), result.getCode());
		        assertEquals("请求参数错误", result.getMessage());
		    }
		```

	3. 访问数据库异常：（编号：hotel-update-3）

		```java
		@Test
		    public void testUpdate_ValidHotel_ExceptionThrown() {
		        // 准备有效的输入，模拟更新过程中抛出异常
		        Hotel hotel = new Hotel();
		        hotel.setId("1");
		        hotel.setImgUrl("new_img_url.jpg");
		        MockHttpSession session = new MockHttpSession();
		
		        // 设置 Mock 对象的行为
		        when(hotelService.getById(hotel.getId())).thenReturn(new Hotel());
		        when(hotelService.updateById(hotel)).thenThrow(new RuntimeException());
		
		        // 调用被测试的方法
		        CommonResult result = hotelController.update(hotel, session);
		
		        // 验证结果
		        assertNotNull(result);
		        assertEquals(Integer.valueOf(500), result.getCode());
		        assertEquals("请求失败", result.getMessage());
		    }
		```

+ 测试结果如下：

![QQ截图20240517112600](%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95.assets/QQ%E6%88%AA%E5%9B%BE20240517112600.png)

+ 其中：
	1. 程序能正确应对输入合法以及访问数据库异常的情况。
	2. 程序无法应对session为null为空对象的情况。



### 4.5.4 add：添加酒店操作

+ 测试用例设计方法：等价类划分

+ 具体用例及测试代码：

	1. 正确等价类：有效的hotel对象（编号：hotel-add-1）

		```java
		@Test
		    public void testAdd_ValidHotel_ValidSession() {
		        // 准备有效的输入
		        Hotel hotel = new Hotel();
		        hotel.setAddTime("2024-05-16"); // 假设这是当前系统时间
		        hotel.setAddUserId("b496894b89754a848e9b74ff66a05d44");
		        MockHttpSession session = new MockHttpSession();
		
		        // 设置 Mock 对象的行为
		        when(hotelService.save(hotel)).thenReturn(true);
		
		        // 调用被测试的方法
		        CommonResult result = hotelController.add(hotel, session);
		
		        // 验证结果
		        assertNotNull(result);
		        assertEquals(Integer.valueOf(200), result.getCode());
		        assertEquals("请求成功", result.getMessage());
		    }
		```

	2. session为null：（编号：car-add-2）

		```java
		@Test
		    public void testAddWithValidCarAndNullSession() {
		        // 准备有效的 Car 对象
		        Car validCar = new Car(/* 设置有效的车辆信息 */);
		
		        // 设置 Mock 对象的行为
		        // 这里不设置对 session 的行为，即 session 为 null
		
		        // 调用被测试的方法
		        CommonResult responseEntity = carController.add(validCar, null);
		
		        // 验证结果
		        Assertions.assertNotEquals(Integer.valueOf(200), responseEntity.getCode()); // 修改为服务器错误的状态码
		        Assertions.assertEquals("请求失败", responseEntity.getMessage()); // 修改为服务器错误的消息
		    }
		```

	  3. 数据库访问异常：（编号：car-add-3）

		```java
			@Test
		    public void testAdd_ValidHotel_ExceptionThrown() {
		        // 准备有效的输入，模拟保存过程中抛出异常
		        Hotel hotel = new Hotel();
		        hotel.setAddTime("2024-05-16"); // 假设这是当前系统时间
		        hotel.setAddUserId("b496894b89754a848e9b74ff66a05d44");
		        MockHttpSession session = new MockHttpSession();
		
		        // 设置 Mock 对象的行为
		        when(hotelService.save(hotel)).thenThrow(new RuntimeException());
		
		        // 调用被测试的方法
		        CommonResult result = hotelController.add(hotel, session);
		
		        // 验证结果
		        assertNotNull(result);
		        assertEquals(Integer.valueOf(500), result.getCode());
		        assertEquals("请求失败", result.getMessage());
		    }
		```

		

+ 测试结果如下：

![QQ截图20240517113012](%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95.assets/QQ%E6%88%AA%E5%9B%BE20240517113012.png)

+ 其中：
	1. 程序默认hotel对象为有效对象，当hotel和session为无效对象时，本该返回错误码500，但仍然返回200，以及没有做出异常判断及措施。



## 4.6 InsuranceController：保险相关操作

### 4.6.1 ：保险删除操作

+ 测试用例设计方法：等价类划分

+ 具体用例及测试代码：

	1. 正确等价类：有效的id（编号：isa-delete-1）

		```java
		@Test
		    public void testDelete_ValidInsuranceId() {
		        // 准备有效的保险ID
		        String insuranceId = "1";
		
		        // 设置 Mock 对象的行为
		        when(insuranceService.getById(insuranceId)).thenReturn(new Insurance());
		        when(insuranceService.updateById(any(Insurance.class))).thenReturn(true);
		
		        // 调用被测试的方法
		        CommonResult result = insuranceController.delete(insuranceId);
		
		        // 验证结果
		        assertNotNull(result);
		        assertEquals(Integer.valueOf(200), result.getCode());
		        assertEquals("请求成功", result.getMessage());
		
		        // 验证保险的删除状态被设置为1
		        verify(insuranceService).updateById(any(Insurance.class));
		    }
		```

	2. 无效的id：（编号：isa-delete-2）

		```java
		@Test
		    public void testDelete_InvalidInsuranceId() {
		        // 准备无效的保险ID
		        String insuranceId = "invalid_id";
		
		        // 设置 Mock 对象的行为
		        when(insuranceService.getById(insuranceId)).thenReturn(null);
		
		        // 调用被测试的方法
		        CommonResult result = insuranceController.delete(insuranceId);
		
		        // 验证结果
		        assertNotNull(result);
		        assertEquals(Integer.valueOf(500), result.getCode());
		        assertEquals("请求失败", result.getMessage());
		
		        // 验证保险的更新方法未被调用
		        verify(insuranceService, never()).updateById(any(Insurance.class));
		    }
		```

	  3. 数据库访问异常

		```java
		@Test
		    public void testDelete_ExceptionThrown() {
		        // 准备模拟异常情况
		        String insuranceId = "1";
		
		        // 设置 Mock 对象的行为
		        when(insuranceService.getById(insuranceId)).thenReturn(new Insurance());
		        when(insuranceService.updateById(any(Insurance.class))).thenThrow(new RuntimeException());
		
		        // 调用被测试的方法
		        CommonResult result = insuranceController.delete(insuranceId);
		
		        // 验证结果
		        assertNotNull(result);
		        assertEquals(Integer.valueOf(500), result.getCode());
		        assertEquals("请求失败", result.getMessage());
		    }
		```

+ 测试结果如下：

![QQ截图20240517121540](%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95.assets/QQ%E6%88%AA%E5%9B%BE20240517121540.png)

+ 测试通过，程序能完美应对输入不合法以及访问异常的情况。



### 4.6.2 update：修改保险信息

+ 测试用例设计方法：等价类划分

+ 具体用例及测试代码：

	1. 正确等价类：合法的insurance和session（编号：isa-update-1）

		```java
		@Test
		    public void testUpdate_ValidInsurance_ValidSession() {
		        // 准备有效的保险信息和模拟的 HttpSession
		        Insurance validInsurance = new Insurance();
		        validInsurance.setId("1");
		        validInsurance.setImgUrl("valid_url"); // 设置图片 URL
		
		        // 设置 Mock 对象的行为
		        EasyMock.expect(insuranceService.getById(validInsurance.getId())).andReturn(validInsurance);
		        EasyMock.expect(insuranceService.updateById(validInsurance)).andReturn(true);
		        EasyMock.replay(insuranceService);
		
		        // 调用被测试的方法
		        CommonResult result = insuranceController.update(validInsurance, sessionMock);
		
		        // 验证结果
		        Assertions.assertEquals(Integer.valueOf(200), result.getCode());
		        Assertions.assertEquals("请求成功", result.getMessage());
		    }
		```

	2. insurance为空对象：（编号：isa-update-2）

		```java
		@Test
		    public void testUpdate_EmptyInsurance_ValidSession() {
		        // 准备空的保险信息和模拟的 HttpSession
		        Insurance emptyInsurance = new Insurance();
		
		        // 调用被测试的方法
		        CommonResult result = insuranceController.update(emptyInsurance, sessionMock);
		
		        // 验证结果
		        Assertions.assertEquals(Integer.valueOf(500), result.getCode());
		        Assertions.assertEquals("请求失败", result.getMessage());
		    }
		```

	3. 访问数据库异常：（编号：isa-update-3）

		```java
		@Test
		    public void testUpdate_ExceptionThrown() {
		        // 准备有效的保险信息和模拟的 HttpSession
		        Insurance validInsurance = new Insurance();
		        validInsurance.setId("1");
		        validInsurance.setImgUrl("valid_url"); // 设置图片 URL
		
		        // 设置 Mock 对象的行为
		        EasyMock.expect(insuranceService.getById(validInsurance.getId())).andReturn(validInsurance);
		        EasyMock.expect(insuranceService.updateById(validInsurance)).andThrow(new RuntimeException());
		        EasyMock.replay(insuranceService);
		
		        // 调用被测试的方法
		        CommonResult result = insuranceController.update(validInsurance, sessionMock);
		
		        // 验证结果
		        Assertions.assertEquals(Integer.valueOf(500), result.getCode());
		        Assertions.assertEquals("请求失败", result.getMessage());
		    }
		```

+ 测试结果如下：

![QQ截图20240517121233](%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95.assets/QQ%E6%88%AA%E5%9B%BE20240517121233.png)

+ 测试通过，程序能正确应对输入不合法以及访问数据库异常的情况。



### 4.6.3 add：添加保险操作

+ 测试用例设计方法：等价类划分

+ 具体用例及测试代码：

	1. 正确等价类：有效的insurance对象（编号：isa-add-1）

		```java
		@Test
		    public void testAdd_ValidInsurance_ValidSession() {
		        // 准备有效的保险信息
		        Insurance validInsurance = new Insurance(/* 设置有效的保险信息 */);
		
		        // 设置 Mock 对象的行为
		        EasyMock.expect(insuranceService.save(validInsurance)).andReturn(true);
		        EasyMock.replay(insuranceService);
		
		        // 调用被测试的方法
		        CommonResult result = insuranceController.add(validInsurance, sessionMock);
		
		        // 验证结果
		        assertEquals(Integer.valueOf(200), result.getCode());
		        assertEquals("请求成功", result.getMessage());
		        assertNotNull(result.getData());
		    }
		```

	2. insurance对象为空：（编号：isa-add-2）

		```java
		@Test
		    public void testAdd_EmptyInsurance_ValidSession() {
		        // 准备空的保险信息
		        Insurance emptyInsurance = new Insurance();
		
		        // 调用被测试的方法
		        CommonResult result = insuranceController.add(emptyInsurance, sessionMock);
		
		        // 验证结果
		        assertEquals(Integer.valueOf(500), result.getCode());
		        assertEquals("请求失败", result.getMessage());
		    }
		```

	  3. 数据库访问异常：（编号：isa-add-3）

		```java
		@Test
		    public void testAdd_ExceptionThrown() {
		        // 准备有效的保险信息
		        Insurance validInsurance = new Insurance(/* 设置有效的保险信息 */);
		
		        // 设置 Mock 对象的行为
		        EasyMock.expect(insuranceService.save(validInsurance)).andThrow(new RuntimeException());
		        EasyMock.replay(insuranceService);
		
		        // 调用被测试的方法
		        CommonResult result = insuranceController.add(validInsurance, sessionMock);
		
		        // 验证结果
		        assertEquals(Integer.valueOf(500), result.getCode());
		        assertEquals("请求失败", result.getMessage());
		    }
		```

		

+ 测试结果如下：

![QQ截图20240517120929](%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95.assets/QQ%E6%88%AA%E5%9B%BE20240517120929.png)

+ 其中：
	1. 程序默认insurance对象为有效对象，当insurance和session为无效对象时，本该返回错误码500，但仍然返回200，以及没有做出异常判断及措施。



## 4.8 PayController：支付相关操作

### 4.8.1 ：queryPayStatus 查询支付状态

+ 测试用例设计方法：等价类划分

+ 具体用例及测试代码：

	1. 正确等价类：有效的id（编号：pay-status-1）

		```java
		@Test
		    public void testUser_queryPayStatus_ValidOrderId_PaymentSuccess() {
		        // 准备有效的订单ID
		        String validOrderId = "valid_id";
		
		        // 设置 Mock 对象的行为
		        Map<String, String> successMap = new HashMap<>();
		        successMap.put("trade_state", "SUCCESS");
		        EasyMock.expect(payServicee.queryPayStatus(validOrderId)).andReturn(successMap);
		        UserOrder userOrder = new UserOrder();
		        EasyMock.expect(userOrderService.getById(validOrderId)).andReturn(userOrder);
		        EasyMock.expect(userOrderService.updateById(userOrder)).andReturn(true);
		        EasyMock.replay(userOrderService, payServicee);
		
		        // 调用被测试的方法
		        CommonResult result = payController.user_queryPayStatus(validOrderId);
		
		        // 验证结果
		        assertEquals(Integer.valueOf(200), result.getCode());
		        assertEquals("支付成功", result.getMessage());
		    }
		```

	2. 无效的id：（编号：pay-status-2）

		```java
		@Test
		    public void testUser_queryPayStatus_InValidOrderId_PaymentFailure() {
		        // 准备无效的订单ID
		        String validOrderId = "invalid_id";
		
		        // 设置 Mock 对象的行为
		        Map<String, String> successMap = new HashMap<>();
		        successMap.put("trade_state", "FAILURE");
		        EasyMock.expect(payServicee.queryPayStatus(validOrderId)).andReturn(successMap);
		        UserOrder userOrder = new UserOrder();
		        EasyMock.expect(userOrderService.getById(validOrderId)).andReturn(userOrder);
		        EasyMock.expect(userOrderService.updateById(userOrder)).andReturn(true);
		        EasyMock.replay(userOrderService, payServicee);
		
		        // 调用被测试的方法
		        CommonResult result = payController.user_queryPayStatus(validOrderId);
		
		        // 验证结果
		        assertEquals(Integer.valueOf(500), result.getCode());
		        assertEquals("支付异常", result.getMessage());
		    }
		```

	  3. 空的id：（编号：pay-status-3）

		```java
		@Test
		    public void testUser_queryPayStatus_EmptyOrderId() {
		        // 准备空的订单ID
		        String emptyOrderId = "";
		
		        // 调用被测试的方法
		        CommonResult result = payController.user_queryPayStatus(emptyOrderId);
		
		        // 验证结果
		        assertEquals(Integer.valueOf(500), result.getCode());
		        assertEquals("支付异常", result.getMessage());
		    }
		```

+ 测试结果如下：

![QQ截图20240517121917](%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95.assets/QQ%E6%88%AA%E5%9B%BE20240517121917.png)

+ 其中：
	+ 程序能正确一堆输入空id和合法id的情况
	+ 程序无法应对不合法id的情况




### 4.8.2 ：toPayOrder 支付订单

+ 测试用例设计方法：等价类划分

+ 具体用例及测试代码：

	1. 正确等价类：有效的id（编号：pay-order-1）

		```java
		@Test
		    public void testUser_topayOrder_ValidOrderId() {
		        // 准备有效的订单ID和模拟的 Model
		        String validOrderId = "valid_id";
		        Model modelMock = mock(Model.class);
		
		        // 准备订单对象
		        UserOrder userOrder = new UserOrder();
		        userOrder.setOrderCode("order_code");
		        userOrder.setProductName("product_name");
		
		        // 设置 Mock 对象的行为
		        when(userOrderService.getById(validOrderId)).thenReturn(userOrder);
		        when(payServicee.callWeiXinCreateOrder(validOrderId, "1", userOrder.getProductName())).thenReturn("pay_url");
		
		        // 调用被测试的方法
		        String result = payController.user_topayOrder(validOrderId, modelMock);
		
		        // 验证结果
		        assertEquals("portal/pay", result);
		        verify(modelMock).addAttribute(eq("payUrl"), anyString());
		        verify(modelMock).addAttribute(eq("order_code"), eq("order_code"));
		        verify(modelMock).addAttribute(eq("fee"), eq(0.01));
		        verify(modelMock).addAttribute(eq("id"), eq(validOrderId));
		    }
		```

	2. 数据库访问异常：（编号：pay-order-2）

		```java
		@Test
		    public void testUser_topayOrder_Exception() {
		        // 准备有效的订单ID和模拟的 Model
		        String validOrderId = "valid_id";
		        Model modelMock = mock(Model.class);
		
		        // 设置 Mock 对象的行为，使其在调用 getById() 方法时抛出异常
		        when(userOrderService.getById(validOrderId)).thenThrow(new RuntimeException("Unable to retrieve order"));
		
		        // 调用被测试的方法
		        String result = payController.user_topayOrder(validOrderId, modelMock);
		
		        // 验证结果
		        assertNull(result);
		        verifyNoInteractions(payServicee, modelMock); // 确保没有其他交互
		    }
		```

	  3. 空的id：（编号：pay-order-3）

		```java
		@Test
		    public void testUser_topayOrder_EmptyOrderId() {
		        // 准备空的订单ID和模拟的 Model
		        String emptyOrderId = "";
		        Model modelMock = mock(Model.class);
		
		        // 调用被测试的方法
		        String result = payController.user_topayOrder(emptyOrderId, modelMock);
		
		        // 验证结果
		        assertNull(result);
		        verifyNoInteractions(userOrderService, payServicee, modelMock);
		    }
		```

+ 测试结果如下：

![QQ截图20240517122412](%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95.assets/QQ%E6%88%AA%E5%9B%BE20240517122412.png)

+ 其中：
	+ 程序能正确执行合法id的情况
	+ 程序无法应对不合法id的情况以及访问异常的情况